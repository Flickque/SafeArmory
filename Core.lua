SafeArmory=LibStub("AceAddon-3.0"):NewAddon("SafeArmory","AceConsole-3.0")local a=LibStub("AceLocale-3.0"):GetLocale("SafeArmory",true)local b=SafeArmory;b.L=a;b.ADDON_NAME="SafeArmory"local c=LibStub("json.lua")local d=LibStub("LibCopyPaste-1.0")local e=LibStub("LibDeflate")b.LibDeflate=e;local f=LibStub("AceDB-3.0")b.ldb=LibStub("LibDataBroker-1.1"):NewDataObject(b.ADDON_NAME,{type="launcher",text="SafeArmory",icon="Interface\\AddOns\\"..b.ADDON_NAME.."\\images\\icon",OnClick=function(self,g,h)if g=="LeftButton"then b:Collect()elseif g=="RightButton"then b:Collect()end end,OnTooltipShow=function(i)i:AddLine(b.L.title,1,1,1)i:AddLine(b.L.notice)i:AddLine(b.L.click)end})b.icon=LibStub("LibDBIcon-1.0")local j={profile={minimap={hide=false,minimapPos=142}}}function b:OnInitialize()SafeArmoryData={data=nil,count=nil}self.db=f:New("SafeArmoryDB",j,true)b.icon:Register(b.ADDON_NAME,b.ldb,self.db.profile.minimap)end;function b:Collect()b.dataCount=0;local k=b:GetAllData()local l=b:CountData(k)local m=GetServerTime()local n=b:first(m)local o=b:last(m)local p=b:CompressData(b:ToJSON(k))local q=string.format("%s:%s:%s:%s:%s",m,n,p,o,l)b:Copy(q)SafeArmoryData={data=q,count=l}end;function b:ToJSON(k)k=c.encode(k)return k end;function b:CompressData(k)k=e:CompressDeflate(k)k=e:EncodeForPrint(k)return k end;function b:Copy(r)d:Copy("SafeArmory",r)end;function b:SlashCommand(s)b:Collect()end;b:RegisterChatCommand("safearmory","SlashCommand")b:RegisterChatCommand("sa","SlashCommand")print(a.title)print(a.welcome)print(a.notice)